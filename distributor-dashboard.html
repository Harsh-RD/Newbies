<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrustCart - Distributor Dashboard</title>
    <meta name="description" content="Distributor Dashboard - Manage your inventory and pricing">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ›’</text></svg>">
</head>
<body class="bg-green-50 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-lg sticky top-0 z-50 border-b border-green-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">ðŸ›’</div>
                    <span class="text-xl font-bold text-green-800">TrustCart</span>
                    <span class="text-sm text-green-600 bg-green-100 px-2 py-1 rounded">Distributor</span>
                </div>
                
                <!-- User Info -->
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-green-700">
                        <i class="fas fa-user mr-1"></i>
                        <span id="userEmail">Loading...</span>
                    </div>
                    <button onclick="logout()" class="text-green-600 hover:text-green-800 text-sm">
                        <i class="fas fa-sign-out-alt mr-1"></i>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 section">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-green-800 mb-2">Distributor Dashboard</h1>
            <p class="text-green-600">Manage your inventory and pricing for street food vendors</p>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600">
                        <i class="fas fa-boxes text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-green-600">Total Items</p>
                        <p class="text-2xl font-bold text-green-800" id="totalItems">0</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                        <i class="fas fa-dollar-sign text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-green-600">Total Value</p>
                        <p class="text-2xl font-bold text-green-800" id="totalValue">â‚¹0</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                        <i class="fas fa-exclamation-triangle text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-green-600">Low Stock</p>
                        <p class="text-2xl font-bold text-green-800" id="lowStockItems">0</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                        <i class="fas fa-chart-line text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-green-600">Avg Price</p>
                        <p class="text-2xl font-bold text-green-800" id="avgPrice">â‚¹0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Table -->
        <div class="card overflow-hidden">
            <div class="px-6 py-4 border-b border-green-200">
                <h2 class="text-xl font-semibold text-green-800">Inventory Management</h2>
                <p class="text-sm text-green-600 mt-1">Click on price or stock to edit, then click Save to update</p>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-green-200">
                    <thead class="bg-green-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase tracking-wider">Item</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase tracking-wider">Category</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase tracking-wider">Price (â‚¹)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase tracking-wider">Stock</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-green-800 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-green-200" id="inventoryTableBody">
                        <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="card">
                <h3 class="text-lg font-semibold text-green-800 mb-4">Quick Actions</h3>
                <div class="space-y-3">
                    <button onclick="exportInventory()" class="btn-primary w-full">
                        <i class="fas fa-download mr-2"></i>
                        Export Inventory
                    </button>
                    <button onclick="importInventory()" class="btn-secondary w-full">
                        <i class="fas fa-upload mr-2"></i>
                        Import Inventory
                    </button>
                    <button onclick="resetInventory()" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl font-semibold transition-colors">
                        <i class="fas fa-refresh mr-2"></i>
                        Reset to Default
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h3 class="text-lg font-semibold text-green-800 mb-4">Recent Activity</h3>
                <div class="space-y-3 text-sm" id="recentActivity">
                    <div class="text-green-600">No recent activity</div>
                </div>
            </div>
            
            <div class="card">
                <h3 class="text-lg font-semibold text-green-800 mb-4">Navigation</h3>
                <div class="space-y-3">
                    <a href="index.html" class="block w-full bg-green-100 hover:bg-green-200 text-green-800 px-4 py-2 rounded-lg font-semibold transition-colors text-center">
                        <i class="fas fa-home mr-2"></i>
                        Back to Home
                    </a>
                    <a href="login.html" class="block w-full bg-green-100 hover:bg-green-200 text-green-800 px-4 py-2 rounded-lg font-semibold transition-colors text-center">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Switch Account
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Mock inventory data
        const defaultInventory = [
            { id: 1, name: 'Fresh Tomatoes', category: 'Vegetables', price: 40, stock: 50, unit: 'kg' },
            { id: 2, name: 'Onions', category: 'Vegetables', price: 25, stock: 100, unit: 'kg' },
            { id: 3, name: 'Potatoes', category: 'Vegetables', price: 30, stock: 75, unit: 'kg' },
            { id: 4, name: 'Chicken Breast', category: 'Meat', price: 180, stock: 20, unit: 'kg' },
            { id: 5, name: 'Rice', category: 'Grains', price: 45, stock: 200, unit: 'kg' },
            { id: 6, name: 'Cooking Oil', category: 'Essentials', price: 120, stock: 30, unit: 'liters' },
            { id: 7, name: 'Spices Mix', category: 'Spices', price: 85, stock: 15, unit: 'packets' },
            { id: 8, name: 'Bread', category: 'Bakery', price: 35, stock: 40, unit: 'loaves' }
        ];

        let inventory = [];
        let recentActivity = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const userRole = localStorage.getItem('trustcart_userRole');
            const userEmail = localStorage.getItem('trustcart_userEmail');
            
            if (!userRole || userRole !== 'distributor' || !userEmail) {
                window.location.href = 'login.html';
                return;
            }
            
            // Display user email
            document.getElementById('userEmail').textContent = userEmail;
            
            // Load inventory
            loadInventory();
            renderInventoryTable();
            updateStats();
        });

        // Load inventory from localStorage or use default
        function loadInventory() {
            const savedInventory = localStorage.getItem('trustcart_distributor_inventory');
            if (savedInventory) {
                inventory = JSON.parse(savedInventory);
            } else {
                inventory = [...defaultInventory];
                saveInventory();
            }
        }

        // Save inventory to localStorage
        function saveInventory() {
            localStorage.setItem('trustcart_distributor_inventory', JSON.stringify(inventory));
        }

        // Render inventory table
        function renderInventoryTable() {
            const tbody = document.getElementById('inventoryTableBody');
            tbody.innerHTML = '';
            
            inventory.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-green-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="text-sm font-medium text-green-900">${item.name}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            ${item.category}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="number" 
                               value="${item.price}" 
                               min="0" 
                               step="0.01"
                               class="w-20 px-2 py-1 border border-green-300 rounded text-sm text-green-900 focus:ring-2 focus:ring-green-500 focus:border-transparent"
                               onchange="updateItem(${item.id}, 'price', this.value)">
                        <span class="text-sm text-green-600 ml-1">â‚¹</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="number" 
                               value="${item.stock}" 
                               min="0"
                               class="w-20 px-2 py-1 border border-green-300 rounded text-sm text-green-900 focus:ring-2 focus:ring-green-500 focus:border-transparent"
                               onchange="updateItem(${item.id}, 'stock', this.value)">
                        <span class="text-sm text-green-600 ml-1">${item.unit}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStockStatusClass(item.stock)}">
                            ${getStockStatusText(item.stock)}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="saveItem(${item.id})" class="text-green-600 hover:text-green-900 mr-3">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update item property
        function updateItem(id, property, value) {
            const item = inventory.find(item => item.id === id);
            if (item) {
                const oldValue = item[property];
                item[property] = parseFloat(value) || 0;
                
                // Add to recent activity
                addActivity(`Updated ${item.name} ${property} from ${oldValue} to ${item[property]}`);
            }
        }

        // Save item changes
        function saveItem(id) {
            saveInventory();
            updateStats();
            showToast('success', 'Item updated successfully!');
        }

        // Get stock status class
        function getStockStatusClass(stock) {
            if (stock > 50) return 'bg-green-100 text-green-800';
            if (stock > 20) return 'bg-yellow-100 text-yellow-800';
            return 'bg-red-100 text-red-800';
        }

        // Get stock status text
        function getStockStatusText(stock) {
            if (stock > 50) return 'In Stock';
            if (stock > 20) return 'Low Stock';
            return 'Out of Stock';
        }

        // Update statistics
        function updateStats() {
            const totalItems = inventory.length;
            const totalValue = inventory.reduce((sum, item) => sum + (item.price * item.stock), 0);
            const lowStockItems = inventory.filter(item => item.stock <= 20).length;
            const avgPrice = inventory.length > 0 ? inventory.reduce((sum, item) => sum + item.price, 0) / inventory.length : 0;
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalValue').textContent = `â‚¹${totalValue.toFixed(0)}`;
            document.getElementById('lowStockItems').textContent = lowStockItems;
            document.getElementById('avgPrice').textContent = `â‚¹${avgPrice.toFixed(0)}`;
        }

        // Add activity to recent activity
        function addActivity(message) {
            const timestamp = new Date().toLocaleTimeString();
            recentActivity.unshift({ message, timestamp });
            
            // Keep only last 5 activities
            if (recentActivity.length > 5) {
                recentActivity = recentActivity.slice(0, 5);
            }
            
            renderRecentActivity();
        }

        // Render recent activity
        function renderRecentActivity() {
            const container = document.getElementById('recentActivity');
            
            if (recentActivity.length === 0) {
                container.innerHTML = '<div class="text-green-600">No recent activity</div>';
                return;
            }
            
            container.innerHTML = recentActivity.map(activity => `
                <div class="flex justify-between items-start">
                    <div class="text-green-800 text-xs">${activity.message}</div>
                    <div class="text-green-500 text-xs">${activity.timestamp}</div>
                </div>
            `).join('');
        }

        // Export inventory
        function exportInventory() {
            const dataStr = JSON.stringify(inventory, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'trustcart-inventory.json';
            link.click();
            URL.revokeObjectURL(url);
            
            addActivity('Exported inventory data');
            showToast('success', 'Inventory exported successfully!');
        }

        // Import inventory
        function importInventory() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedInventory = JSON.parse(e.target.result);
                            inventory = importedInventory;
                            saveInventory();
                            renderInventoryTable();
                            updateStats();
                            addActivity('Imported inventory data');
                            showToast('success', 'Inventory imported successfully!');
                        } catch (error) {
                            showToast('error', 'Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Reset inventory to default
        function resetInventory() {
            if (confirm('Are you sure you want to reset inventory to default values?')) {
                inventory = [...defaultInventory];
                saveInventory();
                renderInventoryTable();
                updateStats();
                addActivity('Reset inventory to default values');
                showToast('success', 'Inventory reset to default values!');
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('trustcart_userRole');
            localStorage.removeItem('trustcart_userEmail');
            localStorage.removeItem('trustcart_userLoginTime');
            window.location.href = 'login.html';
        }

        // Toast notification function
        function showToast(type, message) {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html> 